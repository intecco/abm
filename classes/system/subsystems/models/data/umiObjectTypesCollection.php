<?php
 class umiObjectTypesCollection extends singleton implements iSingleton, iUmiObjectTypesCollection {private $types = Array();protected function __construct() {}public static function getInstance($v4a8a08f09d37b73795649038408b5f33 = NULL) {return parent::getInstance(__CLASS__);}public function getType($v94757cae63fd3e398c0811a976dd6bbe) {if(!$v94757cae63fd3e398c0811a976dd6bbe) {return false;}if(!is_numeric($v94757cae63fd3e398c0811a976dd6bbe)) {$v94757cae63fd3e398c0811a976dd6bbe = $this->getTypeIdByGUID($v94757cae63fd3e398c0811a976dd6bbe);}if($this->isLoaded($v94757cae63fd3e398c0811a976dd6bbe)) {return $this->types[$v94757cae63fd3e398c0811a976dd6bbe];}else {$this->loadType($v94757cae63fd3e398c0811a976dd6bbe);return getArrayKey($this->types, $v94757cae63fd3e398c0811a976dd6bbe);}throw new coreException("Unknow error");}public function getTypeByGUID($v1e0ca5b1252f1f6b1e0ac91be7e7219e) {$vb80bb7740288fda1f201890375a60c8f = $this->getTypeIdByGUID($v1e0ca5b1252f1f6b1e0ac91be7e7219e);return $this->getType($vb80bb7740288fda1f201890375a60c8f);}public function getTypeIdByGUID($v1e0ca5b1252f1f6b1e0ac91be7e7219e) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();if(!$v1e0ca5b1252f1f6b1e0ac91be7e7219e) {return false;}if(!cmsController::$IGNORE_MICROCACHE && isset($v0fea6a13c52b4d4725368f24b045ca84[$v1e0ca5b1252f1f6b1e0ac91be7e7219e])) return $v0fea6a13c52b4d4725368f24b045ca84[$v1e0ca5b1252f1f6b1e0ac91be7e7219e];$v1e0ca5b1252f1f6b1e0ac91be7e7219e = l_mysql_real_escape_string($v1e0ca5b1252f1f6b1e0ac91be7e7219e);$v1b1cc7f086b3f074da452bc3129981eb = "SELECT `id` FROM `cms3_object_types` WHERE `guid` = '{$v1e0ca5b1252f1f6b1e0ac91be7e7219e}'";$result = l_mysql_query($v1b1cc7f086b3f074da452bc3129981eb);if($vcb5e100e5a9a3e7f6d1fd97512215282 = l_mysql_error()) {throw new coreException($vcb5e100e5a9a3e7f6d1fd97512215282);}if(list($vb80bb7740288fda1f201890375a60c8f) = mysql_fetch_row($result)) {return $v0fea6a13c52b4d4725368f24b045ca84[$v1e0ca5b1252f1f6b1e0ac91be7e7219e] = $vb80bb7740288fda1f201890375a60c8f;}else {return $v0fea6a13c52b4d4725368f24b045ca84[$v1e0ca5b1252f1f6b1e0ac91be7e7219e] = false;}}public function addType($v6be379826b20cc58475f636e33f4606b, $vb068931cc450442b63f5b3d276ea4297, $v1945c9a2a5e2ba6133f1db6757a35fcb = false, $vfd2a8ab94cb104d2f8e25a402c260ae4 = false) {$this->disableCache();$v6be379826b20cc58475f636e33f4606b = (int) $v6be379826b20cc58475f636e33f4606b;$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_object_types (parent_id) VALUES('{$v6be379826b20cc58475f636e33f4606b}')";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}$v94757cae63fd3e398c0811a976dd6bbe = l_mysql_insert_id();if (!$vfd2a8ab94cb104d2f8e25a402c260ae4) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT * FROM cms3_object_field_groups WHERE type_id = '{$v6be379826b20cc58475f636e33f4606b}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}while($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($result)) {$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_object_field_groups (name, title, type_id, is_active, is_visible, ord, is_locked) VALUES ('" . l_mysql_real_escape_string($vf1965a857bc285d26fe22023aa5ab50d['name']) . "', '" . l_mysql_real_escape_string($vf1965a857bc285d26fe22023aa5ab50d['title']) . "', '{$v94757cae63fd3e398c0811a976dd6bbe}', '{$vf1965a857bc285d26fe22023aa5ab50d['is_active']}', '{$vf1965a857bc285d26fe22023aa5ab50d['is_visible']}', '{$vf1965a857bc285d26fe22023aa5ab50d['ord']}', '{$vf1965a857bc285d26fe22023aa5ab50d['is_locked']}')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}$v159ce805831f9f42598564e0fbd06f83 = $vf1965a857bc285d26fe22023aa5ab50d['id'];$v5f2444d49c5d43b9cf7a3d7174b983f1 = l_mysql_insert_id();$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_fields_controller SELECT ord, field_id, '{$v5f2444d49c5d43b9cf7a3d7174b983f1}' FROM cms3_fields_controller WHERE group_id = '{$v159ce805831f9f42598564e0fbd06f83}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}}}$vee085e556579b9a69e64e3eddc559b89 = false;if($v6be379826b20cc58475f636e33f4606b) {$v328a21868fce2b3f8569db40f1aa8a89 = $this->getType($v6be379826b20cc58475f636e33f4606b);if($v328a21868fce2b3f8569db40f1aa8a89) {$vee085e556579b9a69e64e3eddc559b89 = $v328a21868fce2b3f8569db40f1aa8a89->getHierarchyTypeId();}}$v599dcce2998a6b40b1e38e8c6006cb0a = new umiObjectType($v94757cae63fd3e398c0811a976dd6bbe);$v599dcce2998a6b40b1e38e8c6006cb0a->setName($vb068931cc450442b63f5b3d276ea4297);$v599dcce2998a6b40b1e38e8c6006cb0a->setIsLocked($v1945c9a2a5e2ba6133f1db6757a35fcb);if($vee085e556579b9a69e64e3eddc559b89) {$v599dcce2998a6b40b1e38e8c6006cb0a->setHierarchyTypeId($vee085e556579b9a69e64e3eddc559b89);}$v599dcce2998a6b40b1e38e8c6006cb0a->commit();$this->types[$v94757cae63fd3e398c0811a976dd6bbe] = $v599dcce2998a6b40b1e38e8c6006cb0a;umiBranch::saveBranchedTablesRelations();return $v94757cae63fd3e398c0811a976dd6bbe;}public function delType($v94757cae63fd3e398c0811a976dd6bbe) {if($this->isExists($v94757cae63fd3e398c0811a976dd6bbe)) {$v599dcce2998a6b40b1e38e8c6006cb0a = $this->getType($v94757cae63fd3e398c0811a976dd6bbe);if ($v599dcce2998a6b40b1e38e8c6006cb0a->getIsLocked()) throw new publicAdminException (getLabel('error-object-type-locked'));$this->disableCache();$vadce578d04ed03c31f6ac59451fcf8e4 = $this->getChildClasses($v94757cae63fd3e398c0811a976dd6bbe);$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($vadce578d04ed03c31f6ac59451fcf8e4);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vd4fd255f51559df00de5424b64292413 = $vadce578d04ed03c31f6ac59451fcf8e4[$v865c0c0b4ab0e063e5caa3387c1a8741];if($this->isExists($vd4fd255f51559df00de5424b64292413)) {$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_objects WHERE type_id = '{$vd4fd255f51559df00de5424b64292413}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_object_types WHERE id = '{$vd4fd255f51559df00de5424b64292413}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_import_types WHERE new_id = '{$vd4fd255f51559df00de5424b64292413}';";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}unset($this->types[$vd4fd255f51559df00de5424b64292413]);}}$v94757cae63fd3e398c0811a976dd6bbe = (int) $v94757cae63fd3e398c0811a976dd6bbe;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_objects WHERE type_id = '{$v94757cae63fd3e398c0811a976dd6bbe}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_object_types WHERE id = '{$v94757cae63fd3e398c0811a976dd6bbe}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_import_types WHERE new_id = '{$v94757cae63fd3e398c0811a976dd6bbe}';";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}unset($this->types[$v94757cae63fd3e398c0811a976dd6bbe]);umiBranch::saveBranchedTablesRelations();return true;}else {return false;}}public function isExists($v94757cae63fd3e398c0811a976dd6bbe) {return true;}private function isLoaded($v94757cae63fd3e398c0811a976dd6bbe) {if($v94757cae63fd3e398c0811a976dd6bbe === false) return false;return (bool) array_key_exists($v94757cae63fd3e398c0811a976dd6bbe, $this->types);}private function loadType($v94757cae63fd3e398c0811a976dd6bbe) {if($this->isLoaded($v94757cae63fd3e398c0811a976dd6bbe)) {return true;}else {$v599dcce2998a6b40b1e38e8c6006cb0a = cacheFrontend::getInstance()->load($v94757cae63fd3e398c0811a976dd6bbe, "object_type");if($v599dcce2998a6b40b1e38e8c6006cb0a instanceof umiObjectType == false) {try {$v599dcce2998a6b40b1e38e8c6006cb0a = new umiObjectType($v94757cae63fd3e398c0811a976dd6bbe);}catch(privateException $ve1671797c52e15f763380b45e841ec32) {return false;}cacheFrontend::getInstance()->save($v599dcce2998a6b40b1e38e8c6006cb0a, "object_type");}if(is_object($v599dcce2998a6b40b1e38e8c6006cb0a)) {$this->types[$v94757cae63fd3e398c0811a976dd6bbe] = $v599dcce2998a6b40b1e38e8c6006cb0a;return true;}else {return false;}}}public function getSubTypesList($v94757cae63fd3e398c0811a976dd6bbe) {if(!is_numeric($v94757cae63fd3e398c0811a976dd6bbe)) {throw new coreException("Type id must be numeric");return false;}$v94757cae63fd3e398c0811a976dd6bbe = (int) $v94757cae63fd3e398c0811a976dd6bbe;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_object_types WHERE parent_id = '{$v94757cae63fd3e398c0811a976dd6bbe}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}$v9b207167e5381c47682c6b4f58a623fb = Array();while(list($v94757cae63fd3e398c0811a976dd6bbe) = mysql_fetch_row($result)) {$v9b207167e5381c47682c6b4f58a623fb[] = (int) $v94757cae63fd3e398c0811a976dd6bbe;}return $v9b207167e5381c47682c6b4f58a623fb;}public function getParentClassId($v94757cae63fd3e398c0811a976dd6bbe) {if($this->isLoaded($v94757cae63fd3e398c0811a976dd6bbe)) {return $this->getType($v94757cae63fd3e398c0811a976dd6bbe)->getParentId();}else {$v94757cae63fd3e398c0811a976dd6bbe = (int) $v94757cae63fd3e398c0811a976dd6bbe;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT parent_id FROM cms3_object_types WHERE id = '{$v94757cae63fd3e398c0811a976dd6bbe}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}if(list($v2e3c048401582f4247d7ccac43657d2d) = mysql_fetch_row($result)) {return (int) $v2e3c048401582f4247d7ccac43657d2d;}else {return false;}}}public function getChildClasses($v94757cae63fd3e398c0811a976dd6bbe, $vadce578d04ed03c31f6ac59451fcf8e4 = false) {$v9b207167e5381c47682c6b4f58a623fb = Array();if(!$vadce578d04ed03c31f6ac59451fcf8e4) $vadce578d04ed03c31f6ac59451fcf8e4 = Array();$v94757cae63fd3e398c0811a976dd6bbe = (int) $v94757cae63fd3e398c0811a976dd6bbe;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_object_types WHERE parent_id = '{$v94757cae63fd3e398c0811a976dd6bbe}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}while(list($vb80bb7740288fda1f201890375a60c8f) = mysql_fetch_row($result)) {$v9b207167e5381c47682c6b4f58a623fb[] = $vb80bb7740288fda1f201890375a60c8f;if(!in_array($vb80bb7740288fda1f201890375a60c8f, $vadce578d04ed03c31f6ac59451fcf8e4)) $v9b207167e5381c47682c6b4f58a623fb = array_merge($v9b207167e5381c47682c6b4f58a623fb, $this->getChildClasses($vb80bb7740288fda1f201890375a60c8f, $v9b207167e5381c47682c6b4f58a623fb));}$v9b207167e5381c47682c6b4f58a623fb = array_unique($v9b207167e5381c47682c6b4f58a623fb);return $v9b207167e5381c47682c6b4f58a623fb;}public function getGuidesList($v805ab0374f72d8da46502cbb00c05464 = false, $va08f2aee9de301619776deb6fee83e50 = null) {$v9b207167e5381c47682c6b4f58a623fb = Array();if($v805ab0374f72d8da46502cbb00c05464) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id, name FROM cms3_object_types WHERE is_guidable = '1' AND is_public = '1'";}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id, name FROM cms3_object_types WHERE is_guidable = '1'";}if($va08f2aee9de301619776deb6fee83e50) {$va08f2aee9de301619776deb6fee83e50 = (int) $va08f2aee9de301619776deb6fee83e50;$vac5c74b64b4b8352ef2f181affb5ac2a .= " AND parent_id = '{$va08f2aee9de301619776deb6fee83e50}'";}$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($vb80bb7740288fda1f201890375a60c8f, $vb068931cc450442b63f5b3d276ea4297) = mysql_fetch_row($result)) {$v9b207167e5381c47682c6b4f58a623fb[$vb80bb7740288fda1f201890375a60c8f] = $this->translateLabel($vb068931cc450442b63f5b3d276ea4297);}return $v9b207167e5381c47682c6b4f58a623fb;}public function getTypesByHierarchyTypeId($v0715f6d9497f93911417c9c324265771, $v35507ea46d2c0b049d7ed968c449223d = false) {static $v0fea6a13c52b4d4725368f24b045ca84 = Array();$v0715f6d9497f93911417c9c324265771 = (int) $v0715f6d9497f93911417c9c324265771;if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v0715f6d9497f93911417c9c324265771]) && $v35507ea46d2c0b049d7ed968c449223d == false) return $v0fea6a13c52b4d4725368f24b045ca84[$v0715f6d9497f93911417c9c324265771];$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id, name FROM cms3_object_types WHERE hierarchy_type_id = '{$v0715f6d9497f93911417c9c324265771}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}$v9b207167e5381c47682c6b4f58a623fb = Array();while(list($vb80bb7740288fda1f201890375a60c8f, $vb068931cc450442b63f5b3d276ea4297) = mysql_fetch_row($result)) {$v9b207167e5381c47682c6b4f58a623fb[$vb80bb7740288fda1f201890375a60c8f] = $this->translateLabel($vb068931cc450442b63f5b3d276ea4297);}return $v0fea6a13c52b4d4725368f24b045ca84[$v0715f6d9497f93911417c9c324265771] = $v9b207167e5381c47682c6b4f58a623fb;}public function getTypeByHierarchyTypeId($v0715f6d9497f93911417c9c324265771, $v35507ea46d2c0b049d7ed968c449223d = false) {static $v0fea6a13c52b4d4725368f24b045ca84 = Array();$v0715f6d9497f93911417c9c324265771 = (int) $v0715f6d9497f93911417c9c324265771;if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v0715f6d9497f93911417c9c324265771]) && $v35507ea46d2c0b049d7ed968c449223d == false && cmsController::$IGNORE_MICROCACHE == false) return $v0fea6a13c52b4d4725368f24b045ca84[$v0715f6d9497f93911417c9c324265771];$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT  id FROM cms3_object_types WHERE hierarchy_type_id = '{$v0715f6d9497f93911417c9c324265771}' LIMIT 1";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}if(list($vb80bb7740288fda1f201890375a60c8f) = mysql_fetch_row($result)) {return $v0fea6a13c52b4d4725368f24b045ca84[$v0715f6d9497f93911417c9c324265771] = $vb80bb7740288fda1f201890375a60c8f;}else {return $v0fea6a13c52b4d4725368f24b045ca84[$v0715f6d9497f93911417c9c324265771] = false;}}public function getAllTypes() {static $v0fea6a13c52b4d4725368f24b045ca84 = Array();if(!empty($v0fea6a13c52b4d4725368f24b045ca84)) return $v0fea6a13c52b4d4725368f24b045ca84;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id, name, guid, is_locked, parent_id, is_guidable, is_public, hierarchy_type_id, sortable FROM cms3_object_types";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = l_mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}$v9b207167e5381c47682c6b4f58a623fb = Array();while($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($result)) {$vf1965a857bc285d26fe22023aa5ab50d['name'] = $this->translateLabel($vf1965a857bc285d26fe22023aa5ab50d['name']);$v9b207167e5381c47682c6b4f58a623fb [$vf1965a857bc285d26fe22023aa5ab50d['id']] = $vf1965a857bc285d26fe22023aa5ab50d;}$v0fea6a13c52b4d4725368f24b045ca84 = $v9b207167e5381c47682c6b4f58a623fb;return $v9b207167e5381c47682c6b4f58a623fb;}public function getBaseType($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce = "") {$vb946c44d711ade3b061653732977d043 = umiHierarchyTypesCollection::getInstance()->getTypeByName($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce);if($vb946c44d711ade3b061653732977d043) {$v0715f6d9497f93911417c9c324265771 = $vb946c44d711ade3b061653732977d043->getId();$v94757cae63fd3e398c0811a976dd6bbe = $this->getTypeByHierarchyTypeId($v0715f6d9497f93911417c9c324265771);return (int) $v94757cae63fd3e398c0811a976dd6bbe;}else {return false;}}public function clearCache() {$v14f802e1fba977727845e8872c1743a7 = array_keys($this->types);foreach($v14f802e1fba977727845e8872c1743a7 as $v3c6e0b8a9c15224a8228b9a98ca1531d) unset($this->types[$v3c6e0b8a9c15224a8228b9a98ca1531d]);$this->types = array();}}?>
