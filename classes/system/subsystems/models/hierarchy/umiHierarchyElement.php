<?php
 class umiHierarchyElement extends umiEntinty implements iUmiEntinty, iUmiHierarchyElement {private $rel, $alt_name, $ord, $object_id,   $type_id, $domain_id, $lang_id, $tpl_id,   $is_deleted = false, $is_active = true, $is_visible = true, $is_default = false, $name,   $update_time,   $object,   $is_broken = false;protected $store_type = "element";public function getIsDeleted() {return $this->is_deleted;}public function getIsActive() {return $this->is_active;}public function getIsVisible() {return $this->is_visible;}public function getLangId() {return $this->lang_id;}public function getDomainId() {return $this->domain_id;}public function getTplId() {return $this->tpl_id;}public function getTypeId() {return $this->type_id;}public function getUpdateTime() {return $this->update_time;}public function getOrd() {return $this->ord;}public function getRel() {return $this->rel;}public function getAltName() {return $this->alt_name;}public function getIsDefault() {return $this->is_default;}public function getObject() {if(isset($this->object) && $this->object) {return $this->object;}else if(isset($this->object_id)) {$this->object = umiObjectsCollection::getInstance()->getObject($this->object_id);return $this->object;}else {return null;}}public function getParentId() {return $this->rel;}public function getName() {return $this->translateLabel($this->name);}public function setName($vb068931cc450442b63f5b3d276ea4297) {$v9b207167e5381c47682c6b4f58a623fb = $this->getObject()->setName($vb068931cc450442b63f5b3d276ea4297);$this->name = $this->object->getName(true);$this->setIsUpdated(true);return $v9b207167e5381c47682c6b4f58a623fb;}public function getValue($vdfc394bd05a4b48161c790034af522a8, $v21ffce5b8a6cc8cc6a41448dd69623c9 = NULL) {$va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject();return $va8cfde6331bd59eb2ac96f8911c4b666 ? $va8cfde6331bd59eb2ac96f8911c4b666->getValue($vdfc394bd05a4b48161c790034af522a8, $v21ffce5b8a6cc8cc6a41448dd69623c9) : false;}public function setValue($vdfc394bd05a4b48161c790034af522a8, $v2771be291c4a714ca95fd1f45a32403e) {if($va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject()) {$result = $va8cfde6331bd59eb2ac96f8911c4b666->setValue($vdfc394bd05a4b48161c790034af522a8, $v2771be291c4a714ca95fd1f45a32403e);$this->setIsUpdated(true);return $result;}else {return false;}}public function setIsVisible($ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = true) {if ($this->is_visible !== ((bool)$ve1c6c9ef2fcbe75f26f815c4ef2e60b4)) {$this->is_visible = (bool) $ve1c6c9ef2fcbe75f26f815c4ef2e60b4;$this->setIsUpdated();}}public function setIsActive($v4264c638e0098acb172519b0436db099 = true) {if ($this->is_active !== ((bool)$v4264c638e0098acb172519b0436db099)) {$this->is_active = (bool) $v4264c638e0098acb172519b0436db099;$this->setIsUpdated();}}public function setIsDeleted($vf49e2553045b3240a95c36854d36dddc = false) {if ($this->is_deleted !== ((bool)$vf49e2553045b3240a95c36854d36dddc)) {$this->is_deleted = (bool) $vf49e2553045b3240a95c36854d36dddc;$this->setIsUpdated();}}public function setTypeId($v94757cae63fd3e398c0811a976dd6bbe) {if ($this->type_id !== ((int)$v94757cae63fd3e398c0811a976dd6bbe)) {$this->type_id = (int) $v94757cae63fd3e398c0811a976dd6bbe;$this->setIsUpdated();}}public function setLangId($v78e6dd7a49f5b0cb2106a3a434dd5c86) {if ($this->lang_id !== ((int)$v78e6dd7a49f5b0cb2106a3a434dd5c86)) {$this->lang_id = (int) $v78e6dd7a49f5b0cb2106a3a434dd5c86;$this->setIsUpdated();}}public function setTplId($vd02e12eb6d6c3f6ebd763197df01e211) {if ($this->tpl_id !== ((int)$vd02e12eb6d6c3f6ebd763197df01e211)) {$this->tpl_id = (int) $vd02e12eb6d6c3f6ebd763197df01e211;$this->setIsUpdated();}}public function setDomainId($v662cbf1253ac7d8750ed9190c52163e5) {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$vadce578d04ed03c31f6ac59451fcf8e4 = $vb81ca7c0ccaa77e7aa91936ab0070695->getChilds($this->id, true, true);foreach($vadce578d04ed03c31f6ac59451fcf8e4 as $vf36263a38d7de5cdaa953c1e2b2f79b5 => $v1a13105b7e4eb5fb2e7c9515ac06aa48) {$v1b7d5726533ab525a8760351e9b5e415 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vf36263a38d7de5cdaa953c1e2b2f79b5, true, true);$v1b7d5726533ab525a8760351e9b5e415->setDomainId($v662cbf1253ac7d8750ed9190c52163e5);$vb81ca7c0ccaa77e7aa91936ab0070695->unloadElement($vf36263a38d7de5cdaa953c1e2b2f79b5);unset($v1b7d5726533ab525a8760351e9b5e415);}if ($this->domain_id !== ((int)$v662cbf1253ac7d8750ed9190c52163e5)) {$this->domain_id = (int) $v662cbf1253ac7d8750ed9190c52163e5;$this->setIsUpdated();}}public function setUpdateTime($ve0df5a999da22bc6fa9e26b115eb4ae4 = 0) {if($ve0df5a999da22bc6fa9e26b115eb4ae4 == 0) {$ve0df5a999da22bc6fa9e26b115eb4ae4 = umiHierarchy::getTimeStamp();}if ($this->update_time !== ((int)$ve0df5a999da22bc6fa9e26b115eb4ae4)) {$this->update_time = (int) $ve0df5a999da22bc6fa9e26b115eb4ae4;$this->setIsUpdated();}}public function setOrd($v8bef1cc20ada3bef55fdf132cb2a1cb9) {if ($this->ord !== ((int)$v8bef1cc20ada3bef55fdf132cb2a1cb9)) {$this->ord = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;$this->setIsUpdated();}}public function setRel($v7ffc4d510260a8544e5550e62ec56bc1) {if ($this->rel !== ((int)$v7ffc4d510260a8544e5550e62ec56bc1)) {$this->rel = (int) $v7ffc4d510260a8544e5550e62ec56bc1;$this->setIsUpdated();}}public function setObject(umiObject $va8cfde6331bd59eb2ac96f8911c4b666, $vac2a04437278cf6e6e597b1b9295b193 = true) {$this->object = $va8cfde6331bd59eb2ac96f8911c4b666;$this->object_id = $va8cfde6331bd59eb2ac96f8911c4b666->getId();if ($vac2a04437278cf6e6e597b1b9295b193) $this->setIsUpdated();}public function setAltName($vd84ff935144e00c3e1d395c2379aca47, $v5c42c04954c401e189bb85786bde8adb = true) {if(!$vd84ff935144e00c3e1d395c2379aca47) {$vd84ff935144e00c3e1d395c2379aca47 = $this->getName();}if($v5c42c04954c401e189bb85786bde8adb) {$vd84ff935144e00c3e1d395c2379aca47 = umiHierarchy::convertAltName($vd84ff935144e00c3e1d395c2379aca47);if(!$vd84ff935144e00c3e1d395c2379aca47) $vd84ff935144e00c3e1d395c2379aca47 = "_";}$vd295b8117d72bf06e54a27bcbfc782cf = $this->alt_name;$this->alt_name = $this->getRightAltName(umiObjectProperty::filterInputString($vd84ff935144e00c3e1d395c2379aca47));if(!$this->alt_name) {$this->alt_name = $vd84ff935144e00c3e1d395c2379aca47;}$v1988c61c48f30d2b39eed4edcf1e3c8b = $this->alt_name;if ($v1988c61c48f30d2b39eed4edcf1e3c8b !== $vd295b8117d72bf06e54a27bcbfc782cf) $this->setIsUpdated();}public function __destruct() {$v16b2b26000987faccb260b9d39df1269 = $this->object_id;parent::__destruct();unset($this->object_id);unset($this->object);umiObjectsCollection::getInstance()->unloadObject($v16b2b26000987faccb260b9d39df1269);}private function getRightAltName($vd84ff935144e00c3e1d395c2379aca47, $v0161cd78b4dc4a09ae9d2bbdb93dddc4 = false) {if (empty($vd84ff935144e00c3e1d395c2379aca47)) $vd84ff935144e00c3e1d395c2379aca47 = '1';if ($this->getRel() == 0 && !IGNORE_MODULE_NAMES_OVERWRITE) {$v6c63406410aa57b3c97b88d3feb09990 = regedit::getInstance()->getList("//modules");foreach($v6c63406410aa57b3c97b88d3feb09990 as $v854203cccade0bbe21be239a208aea49) {if ($vd84ff935144e00c3e1d395c2379aca47 == $v854203cccade0bbe21be239a208aea49[0]) {$vd84ff935144e00c3e1d395c2379aca47 .= '1';break;}}if (langsCollection::getInstance()->getLangId($vd84ff935144e00c3e1d395c2379aca47)) {$vd84ff935144e00c3e1d395c2379aca47 .= '1';}}$vc1332a8893475d77a4cb5226b0e6246d =  array();preg_match("/^([a-z0-9_.-]*)(\d*?)$/U", $vd84ff935144e00c3e1d395c2379aca47, $v66373a9c960d5bb19f89068c5a2797b0);$va2d2953131ec91efe3c90d4dbcee3777 = isset($v66373a9c960d5bb19f89068c5a2797b0[2]) ? $v66373a9c960d5bb19f89068c5a2797b0[2] : NULL;$v544988e29afe707b134aa03709eb443e = isset($v66373a9c960d5bb19f89068c5a2797b0[1]) ? $v66373a9c960d5bb19f89068c5a2797b0[1] : NULL;$v78e6dd7a49f5b0cb2106a3a434dd5c86 = $this->getLangId();$v662cbf1253ac7d8750ed9190c52163e5 = $this->getDomainId();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT alt_name FROM cms3_hierarchy WHERE rel={$this->getRel()} AND id <> {$this->getId()} AND is_deleted = '0' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}' AND alt_name LIKE '{$v544988e29afe707b134aa03709eb443e}%';";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v447b7147e84be512208dcc0995d67ebc) = mysql_fetch_row($result)) $vc1332a8893475d77a4cb5226b0e6246d[] = $v447b7147e84be512208dcc0995d67ebc;if (!empty($vc1332a8893475d77a4cb5226b0e6246d) and in_array($vd84ff935144e00c3e1d395c2379aca47,$vc1332a8893475d77a4cb5226b0e6246d)){foreach($vc1332a8893475d77a4cb5226b0e6246d as $v52dfbb9b0e571701b76699a145406d48){preg_match("/^([a-z0-9_.-]*)(\d*?)$/U", $v52dfbb9b0e571701b76699a145406d48, $v66373a9c960d5bb19f89068c5a2797b0);if (!empty($v66373a9c960d5bb19f89068c5a2797b0[2])) $va2d2953131ec91efe3c90d4dbcee3777 = max($va2d2953131ec91efe3c90d4dbcee3777,$v66373a9c960d5bb19f89068c5a2797b0[2]);}++$va2d2953131ec91efe3c90d4dbcee3777;if ($v0161cd78b4dc4a09ae9d2bbdb93dddc4) {$v363b122c528f54df4a0446b6bab05515 = 0;for ($v363b122c528f54df4a0446b6bab05515 = 1;$v363b122c528f54df4a0446b6bab05515<$va2d2953131ec91efe3c90d4dbcee3777;$v363b122c528f54df4a0446b6bab05515++) {if (!in_array($v544988e29afe707b134aa03709eb443e . $v363b122c528f54df4a0446b6bab05515, $vc1332a8893475d77a4cb5226b0e6246d)) {$va2d2953131ec91efe3c90d4dbcee3777 = $v363b122c528f54df4a0446b6bab05515;break;}}}}return $v544988e29afe707b134aa03709eb443e . $va2d2953131ec91efe3c90d4dbcee3777;}public function setIsDefault($vf62baf4c4ead98d50d516eca0ac5a746 = true) {if ($this->is_default !== ((int)$vf62baf4c4ead98d50d516eca0ac5a746)) {umiHierarchy::getInstance()->clearDefaultElementCache();cacheFrontend::getInstance()->flush();$this->is_default = (int) $vf62baf4c4ead98d50d516eca0ac5a746;$this->setIsUpdated();}}public function getFieldId($v73f329f154a663bfda020aadcdd0b775) {return umiObjectTypesCollection::getInstance()->getType($this->getObject()->getTypeId())->getFieldId($v73f329f154a663bfda020aadcdd0b775);}protected function loadInfo($vf1965a857bc285d26fe22023aa5ab50d = false) {if($vf1965a857bc285d26fe22023aa5ab50d === false) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT h.rel, h.type_id, h.lang_id, h.domain_id, h.tpl_id, h.obj_id, h.ord, h.alt_name, h.is_active, h.is_visible, h.is_deleted, h.updatetime, h.is_default, o.name FROM cms3_hierarchy h, cms3_objects o WHERE h.id = '{$this->id}' AND o.id = h.obj_id";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a, true);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result);}if(list($v7ffc4d510260a8544e5550e62ec56bc1, $v94757cae63fd3e398c0811a976dd6bbe, $v78e6dd7a49f5b0cb2106a3a434dd5c86, $v662cbf1253ac7d8750ed9190c52163e5, $vd02e12eb6d6c3f6ebd763197df01e211, $v818ad5ef6588e140ecb9f81e810c028a, $v8bef1cc20ada3bef55fdf132cb2a1cb9, $vd84ff935144e00c3e1d395c2379aca47, $v4264c638e0098acb172519b0436db099, $ve1c6c9ef2fcbe75f26f815c4ef2e60b4, $vf49e2553045b3240a95c36854d36dddc, $v3e04dc2abd929a9d02e2e0fa41d24bf9, $vf62baf4c4ead98d50d516eca0ac5a746, $vb068931cc450442b63f5b3d276ea4297) = $vf1965a857bc285d26fe22023aa5ab50d) {if(!$v818ad5ef6588e140ecb9f81e810c028a) {umiHierarchy::getInstance()->delElement($this->id);$this->is_broken = true;return false;}$this->rel = (int) $v7ffc4d510260a8544e5550e62ec56bc1;$this->type_id = (int) $v94757cae63fd3e398c0811a976dd6bbe;$this->lang_id = (int) $v78e6dd7a49f5b0cb2106a3a434dd5c86;$this->domain_id = (int) $v662cbf1253ac7d8750ed9190c52163e5;$this->tpl_id = (int) $vd02e12eb6d6c3f6ebd763197df01e211;$this->object_id = (int) $v818ad5ef6588e140ecb9f81e810c028a;$this->ord = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;$this->alt_name = $vd84ff935144e00c3e1d395c2379aca47;$this->is_active = (bool) $v4264c638e0098acb172519b0436db099;$this->is_visible = (bool) $ve1c6c9ef2fcbe75f26f815c4ef2e60b4;$this->is_deleted = (bool) $vf49e2553045b3240a95c36854d36dddc;$this->is_default = (bool) $vf62baf4c4ead98d50d516eca0ac5a746;$this->name = $vb068931cc450442b63f5b3d276ea4297;if (!$v3e04dc2abd929a9d02e2e0fa41d24bf9) {$v3e04dc2abd929a9d02e2e0fa41d24bf9 = umiHierarchy::getTimeStamp();}$this->update_time = (int)$v3e04dc2abd929a9d02e2e0fa41d24bf9;return true;}else {$this->is_broken = true;return false;}}protected function save() {$v7ffc4d510260a8544e5550e62ec56bc1 = (int) $this->rel;$v94757cae63fd3e398c0811a976dd6bbe = (int) $this->type_id;$v78e6dd7a49f5b0cb2106a3a434dd5c86 = (int) $this->lang_id;$v662cbf1253ac7d8750ed9190c52163e5 = (int) $this->domain_id;$vd02e12eb6d6c3f6ebd763197df01e211 = (int) $this->tpl_id;$vaf31437ce61345f416579830a98c91e5 = (int) $this->object_id;$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $this->ord;$vd84ff935144e00c3e1d395c2379aca47 = self::filterInputString($this->alt_name);$v4264c638e0098acb172519b0436db099 = (int) $this->is_active;$ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = (int) $this->is_visible;$vf49e2553045b3240a95c36854d36dddc = (int) $this->is_deleted;$ve0df5a999da22bc6fa9e26b115eb4ae4 = (int) $this->update_time;$vf62baf4c4ead98d50d516eca0ac5a746 = (int) $this->is_default;if($vf62baf4c4ead98d50d516eca0ac5a746) {$vac5c74b64b4b8352ef2f181affb5ac2a ="UPDATE cms3_hierarchy SET is_default = '0' WHERE is_default = '1' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);}$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_hierarchy SET rel = '{$v7ffc4d510260a8544e5550e62ec56bc1}', type_id = '{$v94757cae63fd3e398c0811a976dd6bbe}', lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}', domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}', tpl_id = '{$vd02e12eb6d6c3f6ebd763197df01e211}', obj_id = '{$vaf31437ce61345f416579830a98c91e5}', ord = '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}', alt_name = '{$vd84ff935144e00c3e1d395c2379aca47}', is_active = '{$v4264c638e0098acb172519b0436db099}', is_visible = '{$ve1c6c9ef2fcbe75f26f815c4ef2e60b4}', is_deleted = '{$vf49e2553045b3240a95c36854d36dddc}', updatetime = '{$ve0df5a999da22bc6fa9e26b115eb4ae4}', is_default = '{$vf62baf4c4ead98d50d516eca0ac5a746}' WHERE id = '{$this->id}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if ($this->is_updated) {$v06a943c59f33a34bb5924aaf72cd2995 = searchModel::getInstance();if(PAGES_AUTO_INDEX) {if($this->getIsActive() && $this->getIsDeleted() == false) {$v06a943c59f33a34bb5924aaf72cd2995->index_item($this->id);}else {$v06a943c59f33a34bb5924aaf72cd2995->unindex_items($this->id);}}}if (!umiHierarchy::$ignoreSiteMap) $this->updateSiteMap(true);try {$this->updateYML();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {}return true;}public function updateYML() {$v100664c6e2c0333b19a729f2f3ddb7dd = CURRENT_WORKING_DIR . "/sys-temp/yml/";$v100664c6e2c0333b19a729f2f3ddb7dd = CURRENT_WORKING_DIR . "/sys-temp/yml/";$v6942e8fa62b3cc9d93881a58210e2fd7 = umiHierarchyTypesCollection::getInstance();$v8c028488715d341980c5985fd02bfa1e = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName("catalog", "object");$v3e78669aa9a1bfe336037e3d77a22705 = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName("catalog", "category");$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();if (!$v8c028488715d341980c5985fd02bfa1e || !$v3e78669aa9a1bfe336037e3d77a22705) return false;if ($this->getHierarchyType()->getId() == $v3e78669aa9a1bfe336037e3d77a22705->getId()) {$this->checkYMLinclude();if (!$this->is_active || $this->is_deleted) {$v397c47bd29ed2de23a264b3de9d0aeaf = $vb81ca7c0ccaa77e7aa91936ab0070695->getChildIds($this->getId(), false);foreach($v397c47bd29ed2de23a264b3de9d0aeaf as $vf4f40123eb510dd3290125b38f4eb898) {$v0f635d0e0f3874fff8b581c132e6c7a7 = $v100664c6e2c0333b19a729f2f3ddb7dd . $vf4f40123eb510dd3290125b38f4eb898 . ".txt";if(file_exists($v0f635d0e0f3874fff8b581c132e6c7a7)) unlink($v0f635d0e0f3874fff8b581c132e6c7a7);}}return true;}if ($this->getHierarchyType()->getId() != $v8c028488715d341980c5985fd02bfa1e->getId()) return false;if (!is_dir($v100664c6e2c0333b19a729f2f3ddb7dd)) mkdir($v100664c6e2c0333b19a729f2f3ddb7dd, 0777, true);$v0f635d0e0f3874fff8b581c132e6c7a7 = $v100664c6e2c0333b19a729f2f3ddb7dd . "{$this->id}.txt";if(file_exists($v0f635d0e0f3874fff8b581c132e6c7a7)) unlink($v0f635d0e0f3874fff8b581c132e6c7a7);if ($this->is_active && !$this->is_deleted) {$v9c28d32df234037773be184dbdafc274 = $this->checkYMLinclude();if (!count($v9c28d32df234037773be184dbdafc274)) return false;$vbfa030fe63bacd523dd70a76cfaed98a = $this->getParentId();if ($vbfa030fe63bacd523dd70a76cfaed98a) {$vd0e45878043844ffc41aac437e86b602 = umiHierarchy::getInstance()->getElement($vbfa030fe63bacd523dd70a76cfaed98a, true, true);if ($vd0e45878043844ffc41aac437e86b602->getHierarchyType()->getId() != $v3e78669aa9a1bfe336037e3d77a22705->getId()) {$vbfa030fe63bacd523dd70a76cfaed98a = false;$vc68ad910ed49ac65f21f1bf2c5dbf912 = $vb81ca7c0ccaa77e7aa91936ab0070695->getAllParents($this->id, true, true);for ($v865c0c0b4ab0e063e5caa3387c1a8741 = count($vc68ad910ed49ac65f21f1bf2c5dbf912)-1;$v865c0c0b4ab0e063e5caa3387c1a8741>=0 ;$v865c0c0b4ab0e063e5caa3387c1a8741--) {$veb26d1e3d9eea8920caf827a786b187f = $vc68ad910ed49ac65f21f1bf2c5dbf912[$v865c0c0b4ab0e063e5caa3387c1a8741];$v0b7a661d35d52d96b26b9f3f3bd32aab = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($veb26d1e3d9eea8920caf827a786b187f, true);if ($v0b7a661d35d52d96b26b9f3f3bd32aab instanceof umiHierarchyElement && $v0b7a661d35d52d96b26b9f3f3bd32aab->getHierarchyType()->getId() == $v3e78669aa9a1bfe336037e3d77a22705->getId()) {$vbfa030fe63bacd523dd70a76cfaed98a = $veb26d1e3d9eea8920caf827a786b187f;break;}}}}if (!$vbfa030fe63bacd523dd70a76cfaed98a) {throw new publicAdminException(getLabel('error-update-yml'));}$ved780287e302ec3b9fd3c5e78771919f = new xmlExporter('yml');$ved780287e302ec3b9fd3c5e78771919f->addElements(array($this->id));$ved780287e302ec3b9fd3c5e78771919f->setIgnoreRelations();$vbbd738a112791dd1d0cb6bd0d61d878f = $ved780287e302ec3b9fd3c5e78771919f->execute();$vd0c75bac742760cf71fd76cd75d0c02a = CURRENT_WORKING_DIR . '/xsl/export/YML.xsl';if (!is_file($vd0c75bac742760cf71fd76cd75d0c02a)) {throw new publicException("Can't load exporter {$vd0c75bac742760cf71fd76cd75d0c02a}");}$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument("1.0", "utf-8");$v9a09b4dfda82e3e665e31092d1c3ec8d->formatOutput = XML_FORMAT_OUTPUT;$v9a09b4dfda82e3e665e31092d1c3ec8d->loadXML($vbbd738a112791dd1d0cb6bd0d61d878f->saveXML());$v640eac53ad75db5c49a9ec86390d8530 = umiTemplater::create('XSLT', $vd0c75bac742760cf71fd76cd75d0c02a);$result = $v640eac53ad75db5c49a9ec86390d8530->parse($v9a09b4dfda82e3e665e31092d1c3ec8d);$vdd988cfd769c9f7fbd795a0f5da8e751 = new DOMDocument();$vdd988cfd769c9f7fbd795a0f5da8e751->loadXML($result);$vd60db28d94d538bbb249dcc7f2273ab1 = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('offer')->item(0);if ($vd60db28d94d538bbb249dcc7f2273ab1) {$vc4ef352f74e502ef5e7bc98e6f4e493d = $vd60db28d94d538bbb249dcc7f2273ab1->getElementsByTagName('categoryId')->item(0);if ($vc4ef352f74e502ef5e7bc98e6f4e493d) $vc4ef352f74e502ef5e7bc98e6f4e493d->nodeValue = $vbfa030fe63bacd523dd70a76cfaed98a;$v9a0364b9e99bb480dd25e1f0284c8555 = iconv("UTF-8", "CP1251//IGNORE", $vdd988cfd769c9f7fbd795a0f5da8e751->saveXML($vd60db28d94d538bbb249dcc7f2273ab1));file_put_contents($v0f635d0e0f3874fff8b581c132e6c7a7, $v9a0364b9e99bb480dd25e1f0284c8555);}$v7f24d9fc4140045241b3f97bcf36bf03 = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('currencies')->item(0);$v09c2a312ca0311b5e24340fe8f827077 = iconv("UTF-8", "CP1251//IGNORE", $vdd988cfd769c9f7fbd795a0f5da8e751->saveXML($v7f24d9fc4140045241b3f97bcf36bf03));file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'currencies', $v09c2a312ca0311b5e24340fe8f827077);$vdaeed474badc5873f59f5c1933dfa304 = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('name')->item(0);$vb068931cc450442b63f5b3d276ea4297 = $vdaeed474badc5873f59f5c1933dfa304->nodeValue;$v93c731f1c3a84ef05cd54d044c379eaa = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('company')->item(0);$vdb486e4cdf8b2048591e59f683319c4c = $v93c731f1c3a84ef05cd54d044c379eaa->nodeValue;foreach ($v9c28d32df234037773be184dbdafc274 as $v013b012140e3049c2436475764dfba3c) {file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'shop' . $v013b012140e3049c2436475764dfba3c, '<name>' . iconv("UTF-8", "CP1251//IGNORE", $vb068931cc450442b63f5b3d276ea4297) . '</name><company>' . iconv("UTF-8", "CP1251", $vdb486e4cdf8b2048591e59f683319c4c) . '</company><url>http://' . domainsCollection::getInstance()->getDomain($this->getDomainId())->getHost() . '</url>');}}}protected function checkYMLinclude() {$v100664c6e2c0333b19a729f2f3ddb7dd = CURRENT_WORKING_DIR . "/sys-temp/yml/";if (!is_dir($v100664c6e2c0333b19a729f2f3ddb7dd)) return false;$v736007832d2167baaae763fd3a3f3cf1 = dir($v100664c6e2c0333b19a729f2f3ddb7dd);$v9c28d32df234037773be184dbdafc274 = array();$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$vc68ad910ed49ac65f21f1bf2c5dbf912 = $vb81ca7c0ccaa77e7aa91936ab0070695->getAllParents($this->id, true, true);while (false !== ($v8c7dd922ad47494fc02c388e12c00eac = $v736007832d2167baaae763fd3a3f3cf1->read())) {if(strpos($v8c7dd922ad47494fc02c388e12c00eac, "cat")) {$vb80bb7740288fda1f201890375a60c8f = trim($v8c7dd922ad47494fc02c388e12c00eac, 'cat');$v3b79c910c0feb17f4f4462e3decfb786 = unserialize(file_get_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $v8c7dd922ad47494fc02c388e12c00eac));$vc97e47c7f15ca0e987851078d2318eed = unserialize(file_get_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $vb80bb7740288fda1f201890375a60c8f . "el"));$vea228c391b72961cc1370e2d66442d86 = array_keys(array_intersect($vc68ad910ed49ac65f21f1bf2c5dbf912, $v3b79c910c0feb17f4f4462e3decfb786));$v013b012140e3049c2436475764dfba3c = trim($v8c7dd922ad47494fc02c388e12c00eac, 'cat');$vb0b5ccb4a195a07fd3eed14affb8695f = array();if (file_exists($v100664c6e2c0333b19a729f2f3ddb7dd . 'categories' . $v013b012140e3049c2436475764dfba3c)) {$vb0b5ccb4a195a07fd3eed14affb8695f = unserialize(file_get_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'categories' . $v013b012140e3049c2436475764dfba3c));}if (count($vea228c391b72961cc1370e2d66442d86)) {$vca890278cc5a293ee13dde5e16512d0f = $vea228c391b72961cc1370e2d66442d86[0];if ($vc68ad910ed49ac65f21f1bf2c5dbf912[$vca890278cc5a293ee13dde5e16512d0f] == $this->getId() && $this->getHierarchyType()->getMethod() == 'object') {if (isset($vc68ad910ed49ac65f21f1bf2c5dbf912[$vca890278cc5a293ee13dde5e16512d0f-1])) $vca890278cc5a293ee13dde5e16512d0f--;}for ($v865c0c0b4ab0e063e5caa3387c1a8741 = $vca890278cc5a293ee13dde5e16512d0f;$v865c0c0b4ab0e063e5caa3387c1a8741 < count($vc68ad910ed49ac65f21f1bf2c5dbf912);$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vbfa030fe63bacd523dd70a76cfaed98a = $vc68ad910ed49ac65f21f1bf2c5dbf912[$v865c0c0b4ab0e063e5caa3387c1a8741];$vd0e45878043844ffc41aac437e86b602 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vbfa030fe63bacd523dd70a76cfaed98a);if (!$vd0e45878043844ffc41aac437e86b602 instanceof umiHierarchyElement) continue;if (!$vd0e45878043844ffc41aac437e86b602->getIsActive() || $vd0e45878043844ffc41aac437e86b602->getIsDeleted()) {if ($this->getHierarchyType()->getMethod() == 'object') return $v9c28d32df234037773be184dbdafc274;}if ($vd0e45878043844ffc41aac437e86b602->getHierarchyType()->getMethod() != 'category') continue;if ($vd0e45878043844ffc41aac437e86b602->getIsActive() && !$vd0e45878043844ffc41aac437e86b602->getIsDeleted()) {$vffffe4247e7557c58cc7eb95ff95104e = $vd0e45878043844ffc41aac437e86b602->getName();$vffffe4247e7557c58cc7eb95ff95104e = iconv("UTF-8", "CP1251//IGNORE", $vffffe4247e7557c58cc7eb95ff95104e);$vffffe4247e7557c58cc7eb95ff95104e = strtr($vffffe4247e7557c58cc7eb95ff95104e, array("&" => "&amp;", "<" => "&lt;", ">" => "&gt;"));$v8daec67a558a7355db08d90eeadf7af7 = $vd0e45878043844ffc41aac437e86b602->getParentId();if ($v8daec67a558a7355db08d90eeadf7af7 && isset($vb0b5ccb4a195a07fd3eed14affb8695f[$v8daec67a558a7355db08d90eeadf7af7])) {$vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a] = '<category id="' . $vbfa030fe63bacd523dd70a76cfaed98a . '" parentId="' . $v8daec67a558a7355db08d90eeadf7af7 . '">' . $vffffe4247e7557c58cc7eb95ff95104e . '</category>';}else {$vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a] = '<category id="' . $vbfa030fe63bacd523dd70a76cfaed98a . '">' . $vffffe4247e7557c58cc7eb95ff95104e . '</category>';}}else {if(isset($vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a])) unset($vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a]);}}if(!in_array($this->id, $vc97e47c7f15ca0e987851078d2318eed) && $this->getHierarchyType()->getMethod() == 'object') {$vc97e47c7f15ca0e987851078d2318eed[] = $this->id;file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $vb80bb7740288fda1f201890375a60c8f . "el", serialize($vc97e47c7f15ca0e987851078d2318eed));}$v9c28d32df234037773be184dbdafc274[] = $v013b012140e3049c2436475764dfba3c;}elseif($this->getHierarchyType()->getMethod() == 'category' &&(!$this->getIsActive() || $this->getIsDeleted())) {$vadce578d04ed03c31f6ac59451fcf8e4 = $vb81ca7c0ccaa77e7aa91936ab0070695->getChildIds($this->getId(), false, true);$vea228c391b72961cc1370e2d66442d86 = array_intersect($vadce578d04ed03c31f6ac59451fcf8e4, $v3b79c910c0feb17f4f4462e3decfb786);if (count($vea228c391b72961cc1370e2d66442d86)) {foreach($vadce578d04ed03c31f6ac59451fcf8e4 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $vf4f40123eb510dd3290125b38f4eb898) {if(isset($vb0b5ccb4a195a07fd3eed14affb8695f[$vf4f40123eb510dd3290125b38f4eb898])) unset($vb0b5ccb4a195a07fd3eed14affb8695f[$vf4f40123eb510dd3290125b38f4eb898]);}}}else {if($v3c6e0b8a9c15224a8228b9a98ca1531d =  array_search($this->id, $vc97e47c7f15ca0e987851078d2318eed) && $this->getHierarchyType()->getMethod() == 'object') {unset($vc97e47c7f15ca0e987851078d2318eed[$v3c6e0b8a9c15224a8228b9a98ca1531d]);sort($vc97e47c7f15ca0e987851078d2318eed);file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $vb80bb7740288fda1f201890375a60c8f . "el", serialize($vc97e47c7f15ca0e987851078d2318eed));}}file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'categories' . $v013b012140e3049c2436475764dfba3c, serialize($vb0b5ccb4a195a07fd3eed14affb8695f));}}$v736007832d2167baaae763fd3a3f3cf1->close();return $v9c28d32df234037773be184dbdafc274;}public function updateSiteMap($v5e6575e86b3e73984e620fe59289bb96 = false) {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();if(!$v5e6575e86b3e73984e620fe59289bb96) {$vadce578d04ed03c31f6ac59451fcf8e4 = $vb81ca7c0ccaa77e7aa91936ab0070695->getChilds($this->id, true, true, 1);if (is_array($vadce578d04ed03c31f6ac59451fcf8e4)){foreach ($vadce578d04ed03c31f6ac59451fcf8e4 as $vf4f40123eb510dd3290125b38f4eb898 => $v2063c1608d6e0baf80249c42e2be5804) {$v1b7d5726533ab525a8760351e9b5e415 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vf4f40123eb510dd3290125b38f4eb898)->updateSiteMap($v5e6575e86b3e73984e620fe59289bb96);}}}$v9a5b3630a33f0e1697a63e8c9b24f50c = $vb81ca7c0ccaa77e7aa91936ab0070695->forceAbsolutePath();$v2a304a1348456ccd2234cd71a81bd338 = $vb81ca7c0ccaa77e7aa91936ab0070695->getPathById($this->id, false, false, true);$ve0df5a999da22bc6fa9e26b115eb4ae4 = date('c', $this->update_time);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT level FROM cms3_hierarchy_relations WHERE (rel_id = '' or rel_id is null) and child_id={$this->id}";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v8aac9ddfd8f1554f195cfe07c8bd36f5 = 0.5;while(list($vc9e9a848920877e76685b2e4e76de38d) = mysql_fetch_row($result)) {$v8aac9ddfd8f1554f195cfe07c8bd36f5 = round(1 / ($vc9e9a848920877e76685b2e4e76de38d + 1), 1);if($v8aac9ddfd8f1554f195cfe07c8bd36f5 < 0.1) $v8aac9ddfd8f1554f195cfe07c8bd36f5 = 0.1;}$v100664c6e2c0333b19a729f2f3ddb7dd = CURRENT_WORKING_DIR . "/sys-temp/sitemap/{$this->domain_id}/";if (!is_dir($v100664c6e2c0333b19a729f2f3ddb7dd)) mkdir($v100664c6e2c0333b19a729f2f3ddb7dd, 0777, true);$v0f635d0e0f3874fff8b581c132e6c7a7 = $v100664c6e2c0333b19a729f2f3ddb7dd . "{$this->id}.xml";if(file_exists($v0f635d0e0f3874fff8b581c132e6c7a7)) unlink($v0f635d0e0f3874fff8b581c132e6c7a7);if ($this->is_active && !$this->robots_deny && !$this->is_deleted) {$vdd988cfd769c9f7fbd795a0f5da8e751 = new DOMDocument();$v572d4e421e5e6b9bc11d815e8a027112 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('url');$vce04bd8105c135f89b0dfd5d9c1e8c5d = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('loc', $v2a304a1348456ccd2234cd71a81bd338);$vb988295c268025b49dfb3df26171ddc3 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('priority', $v8aac9ddfd8f1554f195cfe07c8bd36f5);$v206125ac5c6d4ed520748b35f2c02136 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('lastmod', $ve0df5a999da22bc6fa9e26b115eb4ae4);$vdd988cfd769c9f7fbd795a0f5da8e751->appendChild($v572d4e421e5e6b9bc11d815e8a027112);$v572d4e421e5e6b9bc11d815e8a027112->appendChild($vce04bd8105c135f89b0dfd5d9c1e8c5d);$v572d4e421e5e6b9bc11d815e8a027112->appendChild($v206125ac5c6d4ed520748b35f2c02136);$v572d4e421e5e6b9bc11d815e8a027112->appendChild($vb988295c268025b49dfb3df26171ddc3);file_put_contents($v0f635d0e0f3874fff8b581c132e6c7a7, $vdd988cfd769c9f7fbd795a0f5da8e751->saveXML($v572d4e421e5e6b9bc11d815e8a027112));}$vb81ca7c0ccaa77e7aa91936ab0070695->forceAbsolutePath($v9a5b3630a33f0e1697a63e8c9b24f50c);}public function setIsUpdated($v50e544b8aa9b48fae6d78fb7574d402f = true) {parent::setIsUpdated($v50e544b8aa9b48fae6d78fb7574d402f);$this->update_time = time();umiHierarchy::getInstance()->addUpdatedElementId($this->id);if($this->rel) {umiHierarchy::getInstance()->addUpdatedElementId($this->rel);}}public function getIsBroken() {return $this->is_broken;}public function commit() {$va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject();if($va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject) {$va8cfde6331bd59eb2ac96f8911c4b666->commit();$v16b2b26000987faccb260b9d39df1269 = $va8cfde6331bd59eb2ac96f8911c4b666->getId();$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();cacheFrontend::getInstance()->del($v16b2b26000987faccb260b9d39df1269, "object");$va7f1f2c46c62415198e0884b827bd2d2 = $vb81ca7c0ccaa77e7aa91936ab0070695->getObjectInstances($v16b2b26000987faccb260b9d39df1269, true, true);foreach($va7f1f2c46c62415198e0884b827bd2d2 as $va3e6bf52d6871a75cae73e5262de04af) {cacheFrontend::getInstance()->del($va3e6bf52d6871a75cae73e5262de04af, "element");}}parent::commit();}public function getObjectTypeId() {return $this->getObject()->getTypeId();}public function getHierarchyType() {return umiHierarchyTypesCollection::getInstance()->getType($this->type_id);}public function getObjectId() {return $this->object_id;}protected function getType() {$v1723bdd4ee51910267a625cae41ced8a = umiHierarchyTypesCollection::getInstance();return $v1723bdd4ee51910267a625cae41ced8a->getType($this->getTypeId());}public function getModule() {return $this->getType()->getName();}public function getMethod() {return $this->getType()->getExt();}public function delete() {umiHierarchy::getInstance()->delElement($this->id);}public function __sleep() {$vb63119da730344b345cdc8f62a4711e9 = get_class_vars(get_class($this));$vb63119da730344b345cdc8f62a4711e9['object'] = NULL;return array_keys($vb63119da730344b345cdc8f62a4711e9);}public function __get($v51746fc9cfaaf892e94c2d56d7508b37) {switch($v51746fc9cfaaf892e94c2d56d7508b37) {case "id":   return $this->id;case "objectId": return $this->object_id;case "name":  return $this->getName();case "altName":  return $this->getAltName();case "isActive": return $this->getIsActive();case "isVisible": return $this->getIsVisible();case "isDeleted": return $this->getIsDeleted();case "xlink":  return 'upage://' . $this->id;case "link": {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();return $vb81ca7c0ccaa77e7aa91936ab0070695->getPathById($this->id);}default:   return $this->getValue($v51746fc9cfaaf892e94c2d56d7508b37);}}public function __set($v51746fc9cfaaf892e94c2d56d7508b37, $v2063c1608d6e0baf80249c42e2be5804) {switch($v51746fc9cfaaf892e94c2d56d7508b37) {case "id":   throw new coreException("Object id could not be changed");case "name":  return $this->setName($v2063c1608d6e0baf80249c42e2be5804);case "altName":  return $this->setAltName($v2063c1608d6e0baf80249c42e2be5804);case "isActive": return $this->setIsActive($v2063c1608d6e0baf80249c42e2be5804);case "isVisible": return $this->setIsVisible($v2063c1608d6e0baf80249c42e2be5804);case "isDeleted": return $this->setIsDeleted($v2063c1608d6e0baf80249c42e2be5804);default:   return $this->setValue($v51746fc9cfaaf892e94c2d56d7508b37, $v2063c1608d6e0baf80249c42e2be5804);}}public function beforeSerialize($v324b23d9adc662d7f9e99634ed47ab65 = false) {static $va8cfde6331bd59eb2ac96f8911c4b666 = null;if($v324b23d9adc662d7f9e99634ed47ab65 && !is_null($va8cfde6331bd59eb2ac96f8911c4b666)) {$this->object = $va8cfde6331bd59eb2ac96f8911c4b666;}else {$va8cfde6331bd59eb2ac96f8911c4b666 = $this->object;$this->object = null;}}public function afterSerialize() {$this->beforeSerialize(true);}public function afterUnSerialize() {$this->getObject();}};?>
