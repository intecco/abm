<?php
 class umiFile implements iUmiFile {protected $filepath,    $size, $ext, $name, $dirname, $modify_time,    $is_broken = false;public static $mask = 0777;protected static $class_name = 'umiFile';protected static $allowedFileTypes = array(   'txt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'pps', 'ppsx',   'odt', 'sxw', 'ods', 'odg', 'pdf', 'csv',   'html', 'js', 'tpl', 'xsl', 'xml', 'css',   'zip', 'rar', '7z', 'tar', 'gz', 'tar.gz', 'exe', 'msi',   'rtf', 'chm', 'ico', 'jpg', 'jpeg', 'gif', 'png', 'bmp',   'psd', 'flv', 'mp4', 'swf', 'mp3', 'wav', 'wma', 'ogg', 'aac'  );protected static $allowedImageTypes = array('jpg', 'jpeg', 'gif', 'bmp', 'png');protected static $addWaterMark = false;public function __construct($v6a2a431fe8b621037ea949531c28551d) {$v6a2a431fe8b621037ea949531c28551d = str_replace("//", "/", $v6a2a431fe8b621037ea949531c28551d);$v6a2a431fe8b621037ea949531c28551d = str_replace("\\\\", "\\", $v6a2a431fe8b621037ea949531c28551d);if(!@is_file($v6a2a431fe8b621037ea949531c28551d)) {$this->is_broken = true;return false;}$this->filepath = $v6a2a431fe8b621037ea949531c28551d;$this->filepath = str_replace("\\", "/", $v6a2a431fe8b621037ea949531c28551d);$this->loadInfo();}public function delete() {if(is_writable($this->filepath)) {return unlink($this->filepath);}else {return false;}}public function download($v789726e10bf01b1777c5d2ae06bede3e = false) {while (@ob_end_clean());header('HTTP/1.1 200 OK');header("Cache-Control: public, must-revalidate");header("Pragma: no-cache");header("Content-type: application/force-download");header("Content-Length: " . $this->getSize());header('Accept-Ranges: bytes');header("Content-Encoding: None");header("Vary:");header('Content-Transfer-Encoding: Binary');header("Content-Disposition: attachment; filename=" . $this->getFileName());readfile(realpath($this->getFilePath()));if($v789726e10bf01b1777c5d2ae06bede3e) {$this->delete();}exit();}public static function manualUpload($vb068931cc450442b63f5b3d276ea4297, $ve440be6a92dba11caa790215081671ae, $vf7bd60b75b29d79b660a2859395c1a24, $vb2ed5fc91c9760886b14c955ac6c82d7) {if(!$vf7bd60b75b29d79b660a2859395c1a24 || !$vb068931cc450442b63f5b3d276ea4297 || $vb068931cc450442b63f5b3d276ea4297 == ".htaccess" || !is_uploaded_file($ve440be6a92dba11caa790215081671ae)) return 1;if( !in_array(strtolower(substr($vb068931cc450442b63f5b3d276ea4297, strrpos($vb068931cc450442b63f5b3d276ea4297, '.') + 1)), self::$allowedFileTypes) ) return 2;list(,, $v566bbee0f961ad71b54c3c2fd36db053) = array_values(getPathInfo($vb068931cc450442b63f5b3d276ea4297));$vb068931cc450442b63f5b3d276ea4297 = substr($vb068931cc450442b63f5b3d276ea4297, 0, strlen($vb068931cc450442b63f5b3d276ea4297) - strlen($v566bbee0f961ad71b54c3c2fd36db053));$vb068931cc450442b63f5b3d276ea4297 = translit::convert($vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 .= "." . strtolower($v566bbee0f961ad71b54c3c2fd36db053);$v9024b204fb4c4ffdd07ee631ed791f75 = $vb2ed5fc91c9760886b14c955ac6c82d7 . "/" . $vb068931cc450442b63f5b3d276ea4297;if($vb068931cc450442b63f5b3d276ea4297 == ".htaccess") {return 3;}$v566bbee0f961ad71b54c3c2fd36db053 = strtolower($v566bbee0f961ad71b54c3c2fd36db053);if(is_uploaded_file($ve440be6a92dba11caa790215081671ae)) {$v9024b204fb4c4ffdd07ee631ed791f75 = umiFile::getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75);if(move_uploaded_file($ve440be6a92dba11caa790215081671ae, $v9024b204fb4c4ffdd07ee631ed791f75)) {chmod($v9024b204fb4c4ffdd07ee631ed791f75, self::$mask);$v9024b204fb4c4ffdd07ee631ed791f75 = self::getRelPath($v9024b204fb4c4ffdd07ee631ed791f75);return new self::$class_name($v9024b204fb4c4ffdd07ee631ed791f75);}else {return 5;}}else {return 6;}}public static function upload($veeeb23fbd23e52a6a6ff78b9f18cbc4e, $v86536e21993c5a96a4d4c9c9afcc9b17, $vb2ed5fc91c9760886b14c955ac6c82d7, $vb80bb7740288fda1f201890375a60c8f = false) {$va1b423d9a2738b47df059a8a38abbd27 = $vb2ed5fc91c9760886b14c955ac6c82d7;if(substr($va1b423d9a2738b47df059a8a38abbd27, strlen($va1b423d9a2738b47df059a8a38abbd27) - 1, 1) != "/") $va1b423d9a2738b47df059a8a38abbd27 .= "/";$vb2ed5fc91c9760886b14c955ac6c82d7 = realpath($vb2ed5fc91c9760886b14c955ac6c82d7);if(!is_dir($vb2ed5fc91c9760886b14c955ac6c82d7)) {return false;}if(!is_writable($vb2ed5fc91c9760886b14c955ac6c82d7)) {return false;}$v694fbbfc143481cbc48ab8ddeadb00f1 = array("php", "php3", "php4", "php5", "phtml");if($veeeb23fbd23e52a6a6ff78b9f18cbc4e === false && $v86536e21993c5a96a4d4c9c9afcc9b17 === false) {$vb068931cc450442b63f5b3d276ea4297 = $_REQUEST['filename'];$v9a0364b9e99bb480dd25e1f0284c8555 = file_get_contents('php://input');list(,, $v566bbee0f961ad71b54c3c2fd36db053) = array_values(getPathInfo($vb068931cc450442b63f5b3d276ea4297));$vb068931cc450442b63f5b3d276ea4297 = substr($vb068931cc450442b63f5b3d276ea4297, 0, strlen($vb068931cc450442b63f5b3d276ea4297) - strlen($v566bbee0f961ad71b54c3c2fd36db053));$vb068931cc450442b63f5b3d276ea4297 = translit::convert($vb068931cc450442b63f5b3d276ea4297);$v566bbee0f961ad71b54c3c2fd36db053 = strtolower($v566bbee0f961ad71b54c3c2fd36db053);$vb068931cc450442b63f5b3d276ea4297 .= "." . $v566bbee0f961ad71b54c3c2fd36db053;if($vb068931cc450442b63f5b3d276ea4297 == ".htaccess") {return false;}if (in_array($v566bbee0f961ad71b54c3c2fd36db053, $v694fbbfc143481cbc48ab8ddeadb00f1)) return false;if (!in_array( $v566bbee0f961ad71b54c3c2fd36db053, self::$allowedFileTypes)) return false;$v9024b204fb4c4ffdd07ee631ed791f75 = $vb2ed5fc91c9760886b14c955ac6c82d7 . "/" . $vb068931cc450442b63f5b3d276ea4297;if(file_put_contents($v9024b204fb4c4ffdd07ee631ed791f75, $v9a0364b9e99bb480dd25e1f0284c8555) == 0) {return false;}chmod($v9024b204fb4c4ffdd07ee631ed791f75, self::$mask);$v9024b204fb4c4ffdd07ee631ed791f75 = self::getRelPath($v9024b204fb4c4ffdd07ee631ed791f75);return new self::$class_name($v9024b204fb4c4ffdd07ee631ed791f75);}else {global $_FILES;$ve067156fc3a90cfa942be4efa6f5bc7e = &$_FILES;if(!is_array($ve067156fc3a90cfa942be4efa6f5bc7e)) {return false;}if(!isset($ve067156fc3a90cfa942be4efa6f5bc7e[$veeeb23fbd23e52a6a6ff78b9f18cbc4e]) && isset($ve067156fc3a90cfa942be4efa6f5bc7e['pics'])) {$ve067156fc3a90cfa942be4efa6f5bc7e[$veeeb23fbd23e52a6a6ff78b9f18cbc4e] = $ve067156fc3a90cfa942be4efa6f5bc7e['pics'];$veeeb23fbd23e52a6a6ff78b9f18cbc4e = "pics";}if(array_key_exists($veeeb23fbd23e52a6a6ff78b9f18cbc4e, $ve067156fc3a90cfa942be4efa6f5bc7e)) {$v080505fba0c91df9d7cff41d972acaf1 = $ve067156fc3a90cfa942be4efa6f5bc7e[$veeeb23fbd23e52a6a6ff78b9f18cbc4e];if(isset($v080505fba0c91df9d7cff41d972acaf1['size'][$v86536e21993c5a96a4d4c9c9afcc9b17])) {$vb80bb7740288fda1f201890375a60c8f = false;}$vf7bd60b75b29d79b660a2859395c1a24 = ($vb80bb7740288fda1f201890375a60c8f === false) ?             (isset($v080505fba0c91df9d7cff41d972acaf1['size'][$v86536e21993c5a96a4d4c9c9afcc9b17])? $v080505fba0c91df9d7cff41d972acaf1['size'][$v86536e21993c5a96a4d4c9c9afcc9b17] : 0)               :             (isset($v080505fba0c91df9d7cff41d972acaf1['size'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17])? $v080505fba0c91df9d7cff41d972acaf1['size'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17] : 0);if($vf7bd60b75b29d79b660a2859395c1a24 == 0) {return false;}else {$ve440be6a92dba11caa790215081671ae = ($vb80bb7740288fda1f201890375a60c8f === false) ? $v080505fba0c91df9d7cff41d972acaf1['tmp_name'][$v86536e21993c5a96a4d4c9c9afcc9b17] : $v080505fba0c91df9d7cff41d972acaf1['tmp_name'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17];$vb068931cc450442b63f5b3d276ea4297 = ($vb80bb7740288fda1f201890375a60c8f === false) ? $v080505fba0c91df9d7cff41d972acaf1['name'][$v86536e21993c5a96a4d4c9c9afcc9b17] : $v080505fba0c91df9d7cff41d972acaf1['name'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17];if( in_array(substr($vb068931cc450442b63f5b3d276ea4297, strrpos($vb068931cc450442b63f5b3d276ea4297, '.')), $v694fbbfc143481cbc48ab8ddeadb00f1) ) return false;list(,, $v566bbee0f961ad71b54c3c2fd36db053) = array_values(getPathInfo($vb068931cc450442b63f5b3d276ea4297));$vb068931cc450442b63f5b3d276ea4297 = substr($vb068931cc450442b63f5b3d276ea4297, 0, strlen($vb068931cc450442b63f5b3d276ea4297) - strlen($v566bbee0f961ad71b54c3c2fd36db053));$vb068931cc450442b63f5b3d276ea4297 = translit::convert($vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 .= "." . strtolower($v566bbee0f961ad71b54c3c2fd36db053);$v9024b204fb4c4ffdd07ee631ed791f75 = $vb2ed5fc91c9760886b14c955ac6c82d7 . "/" . $vb068931cc450442b63f5b3d276ea4297;if($vb068931cc450442b63f5b3d276ea4297 == ".htaccess") {return false;}$v566bbee0f961ad71b54c3c2fd36db053 = strtolower($v566bbee0f961ad71b54c3c2fd36db053);if( !in_array( $v566bbee0f961ad71b54c3c2fd36db053, self::$allowedFileTypes ) ) {return false;}if(is_uploaded_file($ve440be6a92dba11caa790215081671ae)) {$v9024b204fb4c4ffdd07ee631ed791f75 = umiFile::getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75);if(move_uploaded_file($ve440be6a92dba11caa790215081671ae, $v9024b204fb4c4ffdd07ee631ed791f75)) {chmod($v9024b204fb4c4ffdd07ee631ed791f75, self::$mask);$v9024b204fb4c4ffdd07ee631ed791f75 = self::getRelPath($v9024b204fb4c4ffdd07ee631ed791f75);return new self::$class_name($v9024b204fb4c4ffdd07ee631ed791f75);}else {return false;}}else {return false;}}}else {return false;}}}public static function upload_zip ($v86536e21993c5a96a4d4c9c9afcc9b17, $v8c7dd922ad47494fc02c388e12c00eac = "", $v851148b4fd8fd7ae74bd9100c5c0c898 = "./images/cms/data/", $v043f01e8ecc376fc15ecb17504a1f05e = false)  {if ($v8c7dd922ad47494fc02c388e12c00eac == "") {$ve440be6a92dba11caa790215081671ae = $v86536e21993c5a96a4d4c9c9afcc9b17['tmp_name'];$vb068931cc450442b63f5b3d276ea4297 = $v86536e21993c5a96a4d4c9c9afcc9b17['name'];list(,, $v566bbee0f961ad71b54c3c2fd36db053) = array_values(getPathInfo($vb068931cc450442b63f5b3d276ea4297));$vb068931cc450442b63f5b3d276ea4297 = substr($vb068931cc450442b63f5b3d276ea4297, 0, strlen($vb068931cc450442b63f5b3d276ea4297) - strlen($v566bbee0f961ad71b54c3c2fd36db053));$vb068931cc450442b63f5b3d276ea4297 = translit::convert($vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 .= "." . $v566bbee0f961ad71b54c3c2fd36db053;$v9024b204fb4c4ffdd07ee631ed791f75 = $v851148b4fd8fd7ae74bd9100c5c0c898.$vb068931cc450442b63f5b3d276ea4297;$v51b7b5d0a5d6f26dc31ce613f4966356 = CURRENT_WORKING_DIR . "/sys-temp/uploads";if(!is_dir($v51b7b5d0a5d6f26dc31ce613f4966356)) {mkdir($v51b7b5d0a5d6f26dc31ce613f4966356);}$v3cc7992a6d5b20ce784f6169f4423048 = $v51b7b5d0a5d6f26dc31ce613f4966356.'/'.$vb068931cc450442b63f5b3d276ea4297;if ($v86536e21993c5a96a4d4c9c9afcc9b17['size'] == 0) {return false;}if(is_uploaded_file($ve440be6a92dba11caa790215081671ae)) {$v9024b204fb4c4ffdd07ee631ed791f75 = umiFile::getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75);if(move_uploaded_file($ve440be6a92dba11caa790215081671ae, $v3cc7992a6d5b20ce784f6169f4423048)) {chmod($v3cc7992a6d5b20ce784f6169f4423048, self::$mask);}else {return false;}}else {return false;}}else {$v8c7dd922ad47494fc02c388e12c00eac = CURRENT_WORKING_DIR . "/" . $v8c7dd922ad47494fc02c388e12c00eac;if (!file_exists ($v8c7dd922ad47494fc02c388e12c00eac) || !is_writable($v8c7dd922ad47494fc02c388e12c00eac)) return "File not exists!";$ve6223bee17b330d9aed62e68463e0515 = getPathInfo ($v8c7dd922ad47494fc02c388e12c00eac);if ($ve6223bee17b330d9aed62e68463e0515['extension'] != "zip") {return "It's not zip-file!";}$v9024b204fb4c4ffdd07ee631ed791f75 = $v8c7dd922ad47494fc02c388e12c00eac;$v3cc7992a6d5b20ce784f6169f4423048 = $v8c7dd922ad47494fc02c388e12c00eac;}$vcedff02a1ddad18efd0b59b7b09e0eb5 = self::$addWaterMark;self::$addWaterMark = $v043f01e8ecc376fc15ecb17504a1f05e;$v888d0ee361af3603736f32131e7b20a2 = new PclZip($v3cc7992a6d5b20ce784f6169f4423048);$v10ae9fc7d453b0dd525d0edf2ede7961 = $v888d0ee361af3603736f32131e7b20a2->listContent();if (count($v10ae9fc7d453b0dd525d0edf2ede7961)<1) {throw new publicAdminException(getLabel('zip-file-empty'));}$v79001f389eb5f5185f6945430cb57be1 = cmsController::getInstance()->getModule('data')->getAllowedMaxFileSize();$ve6a7ab42343e8bc9131d89646abcb773 = regedit::getInstance()->getVal("//settings/max_img_filesize");if (!$ve6a7ab42343e8bc9131d89646abcb773) {$ve6a7ab42343e8bc9131d89646abcb773 = $v79001f389eb5f5185f6945430cb57be1;}$ve6a7ab42343e8bc9131d89646abcb773 = $ve6a7ab42343e8bc9131d89646abcb773 * 1024 * 1024;$va80da1282f2c775bbc5f2c92c836968b = 0;foreach($v10ae9fc7d453b0dd525d0edf2ede7961 as $v3c6e0b8a9c15224a8228b9a98ca1531d=>$v8a8e67a18097123aaa2495f5465224da) {$v566bbee0f961ad71b54c3c2fd36db053 = strtolower(preg_replace('/^[^.]*\./', '', $v8a8e67a18097123aaa2495f5465224da['filename']));if (!umiFile::isAllowedImageType($v566bbee0f961ad71b54c3c2fd36db053)) {unset($v10ae9fc7d453b0dd525d0edf2ede7961[$v3c6e0b8a9c15224a8228b9a98ca1531d]);continue;}if ($v8a8e67a18097123aaa2495f5465224da['size']>$ve6a7ab42343e8bc9131d89646abcb773) {throw new publicAdminException(getLabel('zip-file-image-max-size')."{$v8a8e67a18097123aaa2495f5465224da['filename']}");}$va80da1282f2c775bbc5f2c92c836968b+=$v8a8e67a18097123aaa2495f5465224da['size'];}if (count($v10ae9fc7d453b0dd525d0edf2ede7961)<1) {throw new publicAdminException(getLabel('zip-file-images-absent'));}if (!checkAllowedDiskSize($va80da1282f2c775bbc5f2c92c836968b)) {throw new publicAdminException(getLabel('zip-file-images-no-free-size'));}$v10ae9fc7d453b0dd525d0edf2ede7961 = $v888d0ee361af3603736f32131e7b20a2->extract(PCLZIP_OPT_PATH, $v851148b4fd8fd7ae74bd9100c5c0c898,    PCLZIP_CB_PRE_EXTRACT, "callbackPreExtract",    PCLZIP_CB_POST_EXTRACT, "callbackPostExtract",    PCLZIP_OPT_REMOVE_ALL_PATH);self::$addWaterMark = $vcedff02a1ddad18efd0b59b7b09e0eb5;if (!is_array ($v10ae9fc7d453b0dd525d0edf2ede7961)) {throw new coreException ("Zip extracting error: ".$v888d0ee361af3603736f32131e7b20a2->errorInfo(true));}if(is_writable($v3cc7992a6d5b20ce784f6169f4423048)) {unlink($v3cc7992a6d5b20ce784f6169f4423048);}return $v10ae9fc7d453b0dd525d0edf2ede7961;}public function getFileName() {return $this->name;}public function getDirName() {return $this->dirname;}public function getModifyTime() {return $this->modify_time;}public function getExt() {return $this->ext;}public function getSize() {return $this->size;}public function getFilePath($v335fe1286880112c216697dceb9e2bd3 = false) {if($v335fe1286880112c216697dceb9e2bd3) {$vbf7be97451be760d000d8fd7b26c5a3d = ini_get("include_path");if ($vbf7be97451be760d000d8fd7b26c5a3d!='.' && substr($this->filepath, 0, strlen($vbf7be97451be760d000d8fd7b26c5a3d)) === $vbf7be97451be760d000d8fd7b26c5a3d) {return "/" . substr($this->filepath, strlen($vbf7be97451be760d000d8fd7b26c5a3d));}$vbf7be97451be760d000d8fd7b26c5a3d = CURRENT_WORKING_DIR;if (substr($this->filepath, 0, strlen($vbf7be97451be760d000d8fd7b26c5a3d)) === $vbf7be97451be760d000d8fd7b26c5a3d) {return substr($this->filepath, strlen($vbf7be97451be760d000d8fd7b26c5a3d));}return (substr($this->filepath, 0, 2) == "./") ? ("/" . substr($this->filepath, 2, strlen($this->filepath) - 2)) : $this->filepath;}else {return $this->filepath;}}private function loadInfo() {if(!is_file($this->filepath)) {$this->is_broken = true;return false;}if(!is_readable($this->filepath)) {$this->is_broken = true;return false;}$va93b85dcfbb9969f5bb3c6be71737ed5 = getPathInfo($this->filepath);$this->modify_time = filemtime($this->filepath);$this->size = filesize($this->filepath);$this->dirname = $va93b85dcfbb9969f5bb3c6be71737ed5['dirname'];$this->name = $va93b85dcfbb9969f5bb3c6be71737ed5['basename'];$this->ext = strtolower(getArrayKey($va93b85dcfbb9969f5bb3c6be71737ed5, 'extension'));if($this->ext == "php" || $this->ext == "php5" || $this->ext == "phtml") {$this->is_broken = true;}if($this->name == ".htaccess") {$this->is_broken = true;}}public function __toString() {$v6a2a431fe8b621037ea949531c28551d = $this->getFilePath(true);return is_null($v6a2a431fe8b621037ea949531c28551d) ? "" : $v6a2a431fe8b621037ea949531c28551d;}public function getIsBroken() {return (bool) $this->is_broken;}public static function getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75) {if(!file_exists($v9024b204fb4c4ffdd07ee631ed791f75)) {return $v9024b204fb4c4ffdd07ee631ed791f75;}else {$vcaf9b6b99962bf5c2264824231d7a40c = getPathInfo($v9024b204fb4c4ffdd07ee631ed791f75);$v954eef6d6eac59aca304b6d7abb4fb3e = $vcaf9b6b99962bf5c2264824231d7a40c['dirname'];$v435ed7e9f07f740abf511a62c00eef6e = $vcaf9b6b99962bf5c2264824231d7a40c['filename'];$vabf77184f55403d75b9d51d79162a7ca = $vcaf9b6b99962bf5c2264824231d7a40c['extension'];for($v865c0c0b4ab0e063e5caa3387c1a8741 = 1;$v865c0c0b4ab0e063e5caa3387c1a8741 < 257;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v9024b204fb4c4ffdd07ee631ed791f75 = $v954eef6d6eac59aca304b6d7abb4fb3e . "/" . $v435ed7e9f07f740abf511a62c00eef6e . $v865c0c0b4ab0e063e5caa3387c1a8741 . "." . $vabf77184f55403d75b9d51d79162a7ca;if(!file_exists($v9024b204fb4c4ffdd07ee631ed791f75)) {return $v9024b204fb4c4ffdd07ee631ed791f75;}}throw new coreException("This is really hard to happen");}}protected static function getRelPath($vd6fe1d0be6347b8ef2427fa629c04485) {$v109633366fd0d46d371ede589998abaa = realpath(getcwd());return "." . substr(realpath($vd6fe1d0be6347b8ef2427fa629c04485), strlen($v109633366fd0d46d371ede589998abaa));}public static function getAddWaterMark() {return self::$addWaterMark;}public static function isAllowedImageType($v566bbee0f961ad71b54c3c2fd36db053) {return in_array($v566bbee0f961ad71b54c3c2fd36db053, self::$allowedImageTypes);}};function callbackPreExtract ($v50cd20d6ab1f950f5f7cd9594d824078, &$v346210869c15b12ae6d906bb9e095aac) {$vcaf9b6b99962bf5c2264824231d7a40c = getPathInfo($v346210869c15b12ae6d906bb9e095aac['filename']);$v566bbee0f961ad71b54c3c2fd36db053 = strtolower($vcaf9b6b99962bf5c2264824231d7a40c['extension']);if (!umiFile::isAllowedImageType($v566bbee0f961ad71b54c3c2fd36db053)) {return 0;}$v954eb83bca864c64ee1e669dfab01c95 = substr($vcaf9b6b99962bf5c2264824231d7a40c['basename'], 0, (strlen($vcaf9b6b99962bf5c2264824231d7a40c['basename']) - strlen($vcaf9b6b99962bf5c2264824231d7a40c['extension']))-1);$v954eb83bca864c64ee1e669dfab01c95 = translit::convert($v954eb83bca864c64ee1e669dfab01c95);$v346210869c15b12ae6d906bb9e095aac['filename'] = $vcaf9b6b99962bf5c2264824231d7a40c['dirname']."/".$v954eb83bca864c64ee1e669dfab01c95.".".$vcaf9b6b99962bf5c2264824231d7a40c['extension'];$v346210869c15b12ae6d906bb9e095aac['filename'] = umiFile::getUnconflictPath($v346210869c15b12ae6d906bb9e095aac['filename']);return 1;}function callbackPostExtract ($v50cd20d6ab1f950f5f7cd9594d824078, &$v346210869c15b12ae6d906bb9e095aac) {$vcaf9b6b99962bf5c2264824231d7a40c = getPathInfo($v346210869c15b12ae6d906bb9e095aac['stored_filename']);$v566bbee0f961ad71b54c3c2fd36db053 = strtolower($vcaf9b6b99962bf5c2264824231d7a40c['extension']);$v435ed7e9f07f740abf511a62c00eef6e = $v346210869c15b12ae6d906bb9e095aac['filename'];if (!umiFile::isAllowedImageType($v566bbee0f961ad71b54c3c2fd36db053)) {unlink ($v435ed7e9f07f740abf511a62c00eef6e);}else {$v3f6abb5601f05f03e3fdf4dec2668666 = @getimagesize($v435ed7e9f07f740abf511a62c00eef6e);if (!is_array($v3f6abb5601f05f03e3fdf4dec2668666)) {@unlink($v435ed7e9f07f740abf511a62c00eef6e);}if(umiFile::getAddWaterMark()) {if (umiImageFile::addWatermark($v435ed7e9f07f740abf511a62c00eef6e) !== false) return 1;}$vf9a3266ad8c9b1c7135d1e0d787fe91b = (bool) mainConfiguration::getInstance()->get("kernel", "jpg-through-gd");if ($vf9a3266ad8c9b1c7135d1e0d787fe91b) {if ($v566bbee0f961ad71b54c3c2fd36db053 == 'jpg' || $v566bbee0f961ad71b54c3c2fd36db053 == 'jpeg'){$v9b207167e5381c47682c6b4f58a623fb = imagecreatefromjpeg($v435ed7e9f07f740abf511a62c00eef6e);if($v9b207167e5381c47682c6b4f58a623fb) {imagejpeg($v9b207167e5381c47682c6b4f58a623fb, $v435ed7e9f07f740abf511a62c00eef6e, 100);imagedestroy($v9b207167e5381c47682c6b4f58a623fb);}}}}return 1;}?>